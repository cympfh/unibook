# リリースノート

## バグ修正 (2025-12-22)

- **Prismシンタックスハイライトのタイミング問題を修正**: コードブロックのシンタックスハイライトが正しく適用されるようになりました
  - ページロード時にハイライトが適用されないタイミング問題を修正
  - window load イベントの100ms後に`Prism.highlightAll()`を再実行
  - すべてのリソース（Prismスクリプトを含む）がロード完了後に実行されることを保証
  - 新規アセット:
    - `assets/prism-retry.js`: Prismハイライトの再実行スクリプト
  - 変更されたファイル: `src/builder.rs`, `src/search_assets.rs`

## パフォーマンス改善 (2025-12-22)

- **差分ビルド機能**: `serve`と`watch`コマンドで変更されたページのみをビルド
  - ファイル変更時、そのファイルに対応するページだけを再ビルド
  - 複数ページがある大規模なプロジェクトでビルド時間を大幅に短縮
  - `book.toml`が変更された場合は全ページをリビルド
  - `build`コマンドは従来通り全ページをビルド（本番用）
  - 検索インデックスは自動的に更新
  - 実装詳細:
    - `Builder::build_incremental()` メソッドを追加
    - パスの正規化により変更検知の精度を向上
    - アセット生成とページビルドを分離して効率化
  - 変更されたファイル: `src/builder.rs`, `src/main.rs`

## 新機能 (2025-12-22)

- **コードブロックにコピーボタンを追加**: コードを簡単にクリップボードにコピーできるようになりました
  - すべての `<code>` ブロックに「Copy」ボタンを自動追加
  - コードブロックにホバーすると右上にボタンが表示される
  - ボタンをクリックでクリップボードにコピー
  - コピー成功/失敗のビジュアルフィードバック表示
    - 成功時: 緑色のチェックマークとともに「Copied!」を2秒間表示
    - 失敗時: 赤色の警告アイコンとともに「Failed」を2秒間表示
  - モバイル端末では常時表示（透明度を下げて表示）
  - すべてのカラーテーマに対応（テーマ変数を使用）
  - 新規アセット:
    - `assets/code-copy.css`: コピーボタンのスタイル定義
    - `assets/code-copy.js`: コピー機能の実装とフィードバック処理
  - 変更されたファイル: `src/builder.rs`, `src/search_assets.rs`

## 新機能 (2025-12-21)

- **サイドバー（目次）トグルボタン**: サイドバーの表示/非表示を切り替えられるトグルボタンを追加
  - ハンバーガーメニューアイコン（☰）をクリックするとサイドバーがスライドアウト/イン
  - テーマ切り替えボタンの左隣に配置（デザインリニューアル）
  - 開閉状態は localStorage に保存され、ページ遷移後も保持されます
  - スムーズなアニメーション効果（0.3秒のトランジション）
  - 新規アセット:
    - `assets/toc-toggle.html`: トグルボタンのHTML構造
    - `assets/toc-toggle.css`: トグルボタンとサイドバーアニメーションのスタイル
    - `assets/toc-toggle.js`: トグル機能とlocalStorageの実装
    - `assets/page-controls-start.html`, `assets/page-controls-end.html`: ボタン配置用コンテナ
  - ボタンはボーダーレスでフラットなデザインに統一
  - 変更されたファイル: `src/builder.rs`, `src/search_assets.rs`, `src/toc.rs`, `assets/theme-switcher.css`

## 新機能 (2025-12-21)

- **Part階層のサポート**: 目次でchapterより上の階層（part）を表現できるようになりました
  - `book.toml` で `path` を指定しない `[[pages]]` エントリを part として扱います
  - part は目次に太字・uppercaseで表示され、リンクはありません（見出しのみ）
  - HTMLページは生成されません
  - 設定例:
    ```toml
    [[pages]]
    title = "Part 1: 基礎編"
    # path なし = part

    [[pages]]
    title = "第1章"
    path = "chapter1.md"
    ```
  - 変更されたファイル: `src/config.rs`, `src/book.rs`, `src/toc.rs`, `src/builder.rs`, `src/search.rs`

## バグ修正・改善 (2025-12-21)

- **テーブルスタイルの改善**: Markdownで記述したテーブルの見た目を大幅に改善
  - 罫線を追加してセル間の区切りを明確化
  - ヘッダー行には背景色を適用
  - 偶数行・奇数行で異なる背景色（ストライプ表示）
  - ホバー時のハイライト効果
  - すべての色はテーマ変数を使用し、6つのカラーテーマすべてに対応
  - 変更されたファイル: `src/toc.rs`

- **サブディレクトリ構造の保持**: `src/a/b.md` が `docs/b.html` ではなく正しく `docs/a/b.html` に出力されるように修正
  - `src/book.rs`: `source_to_html_filename` 関数がディレクトリ構造を保持するように変更
  - `src/builder.rs`: 出力ファイルの親ディレクトリが存在しない場合に自動作成するように対応
  - `src/builder.rs`: TOCファイル名生成時にパスセパレータをアンダースコアに置き換えて一時ディレクトリへの書き込みエラーを修正
  - テストケースを追加してサブディレクトリパスの動作を検証

- **目次リンクを絶対パスに変更**: ナビゲーションの信頼性を向上
  - `src/toc.rs`: ページリンクとセクションリンクを相対パス (`page.html`) から絶対パス (`/page.html`) に変更
  - サブディレクトリ構造でもリンクが正しく機能するようになりました
  - テストケースを更新して絶対パスの動作を検証
